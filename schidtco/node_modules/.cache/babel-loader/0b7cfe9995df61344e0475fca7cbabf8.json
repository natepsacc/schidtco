{"ast":null,"code":"var _require = require('multiformats'),\n    CID = _require.CID;\n\nvar uploadFile = function uploadFile(s3, params) {\n  var cb = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};\n  return new Promise(function (resolve, reject) {\n    var request = s3.putObject(params);\n    request.on('complete', function (response) {\n      try {\n        var ETag = response.data.ETag;\n        var hash = ETag.replace(/^\"|\"$/g, '');\n        var cidObj = CID.parse(hash);\n        var cidv0;\n        var cidv1 = cidObj.toV1().toString();\n\n        try {\n          cidv0 = cidObj.toV0().toString();\n        } catch (e) {\n          // fallback when cbor is used\n          cidv0 = cidv1;\n        }\n\n        resolve({\n          hash: cidv1,\n          hashV0: cidv0\n        });\n      } catch (e) {\n        reject(e);\n      }\n    });\n    request.on('error', function (error) {\n      reject(error);\n    });\n    request.on('httpUploadProgress', function (event) {\n      cb(event);\n    });\n    request.send();\n  });\n};\n\nmodule.exports = uploadFile;","map":null,"metadata":{},"sourceType":"script"}